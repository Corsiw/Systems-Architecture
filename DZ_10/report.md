# **Отчёт по работе: Параллельная генерация и суммирование чисел с потоками POSIX** Терехов Дмитрий 8 баллов.


## 1. Цель задачи

Разработать многопоточную программу на C с использованием POSIX (`pthreads`), в которой:

1. 100 источников информации (потоков) генерируют целые числа от 1 до 100 с разной задержкой (1–7 секунд).
2. Числа поступают в общий буфер.
3. Поток-монитор отслеживает поступление данных и при наличии пары любых чисел создаёт поток-сумматор.
4. Поток-сумматор суммирует числа с задержкой 3–6 секунд и возвращает результат в общий буфер.
5. Процесс продолжается, пока в буфере не останется одно число — итоговая сумма.

---

## 2. Основные идеи решения

### 2.1 Структура программы

* **Источники данных:** 100 потоков, каждый генерирует случайное число и помещает его в буфер.
* **Буфер:** массив `buffer[]`, защищённый мьютексом `pthread_mutex_t buf_mutex` для синхронизации доступа.
* **Монитор:** поток, который постоянно проверяет буфер. Если есть хотя бы две цифры, берёт пару и создаёт поток-сумматор.
* **Сумматоры:** каждый поток суммирует полученную пару с задержкой 3–6 секунд и возвращает результат обратно в буфер.

### 2.2 Передача данных потокам

* Для **источников** используется структура `SourceArg`, содержащая идентификатор потока.
* Для **сумматоров** используется структура `SumArg`, содержащая два числа для суммирования.
* Потоки-сумматоры создаются динамически и работают в detached-режиме (`pthread_detach`), чтобы не блокировать основной поток.

### 2.3 Синхронизация

* Доступ к буферу осуществляется через **мьютекс**, чтобы избежать гонок данных.
* Монитор проверяет буфер и создаёт сумматор только при наличии **двух чисел**.
* Основной поток ждёт завершения всех источников и монитора через `pthread_join`.

### 2.4 Завершение

* Программа завершается, когда в буфере остаётся одно число — итоговая сумма.

---

## 3. Запуска программы

### 3.1 Компиляция

Используем `g++`:

```bash
g++ -o sum src/sum.cpp
```

### 3.2 Запуск

```bash
./sum
```

## 4. Особенности реализации

1. Использование **структур для передачи аргументов потокам** повышает читаемость и безопасность.
2. **Detached-потоки для сумматоров** позволяют создавать множество параллельных сумматоров без необходимости их join.
3. **Мьютекс** гарантирует корректный доступ к общему буферу.
4. Программа масштабируема — количество источников, диапазон чисел и задержки легко изменяются через константы.
